<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¡×¢ ×”×“×¨×§×•×Ÿ ×”×—×›×: ×©×•××¨×™ ×”×¨×©×ª âœ¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            direction: rtl; /* Right-to-left for Hebrew */
            background-color: #f0f4f8; /* Light blue-gray background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .game-container {
            background: linear-gradient(135deg, #a7e4ff, #82d1f9); /* Blue gradient */
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            max-width: 900px;
            width: 100%;
            text-align: center;
            border: 2px solid #5ab0e7;
            position: relative;
            overflow: hidden;
            min-height: 500px; /* Ensure enough height for content */
        }
        .header {
            color: #1a4d69;
            font-weight: 700;
            font-size: 2.25rem; /* text-4xl */
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.7);
        }
        .scene-description {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            color: #333;
            font-size: 1.15rem;
            line-height: 1.6;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
            border: 1px solid #cceeff;
        }
        .dilemma-prompt {
            color: #1a4d69;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
        }
        .choices-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        .choice-button {
            background-color: #4CAF50; /* Green */
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .choice-button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.3);
        }
        .choice-button:active {
            transform: translateY(0);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .choice-button.deficient { background-color: #ef4444; } /* Red for deficient */
        .choice-button.deficient:hover { background-color: #dc2626; }
        .choice-button.beneficial { background-color: #22c55e; } /* Green for beneficial */
        .choice-button.beneficial:hover { background-color: #16a34a; }
        .choice-button.excessive { background-color: #f97316; } /* Orange for excessive */
        .choice-button.excessive:hover { background-color: #ea580c; }

        .feedback-section {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            color: #333;
            font-size: 1.1rem;
            line-height: 1.6;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            border: 1px solid #cceeff;
            display: none; /* Hidden by default */
        }
        .feedback-header {
            font-weight: 700;
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: #1a4d69;
        }
        .dilemma-image {
            width: 100%;
            max-width: 300px;
            height: auto;
            border-radius: 15px;
            margin: 25px auto;
            border: 3px solid #fff;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            display: block; /* Ensures centering */
        }
        .bezen-dialogue {
            background-color: rgba(200, 230, 255, 0.9);
            border-radius: 15px;
            padding: 15px;
            margin-top: 25px;
            color: #1a4d69;
            font-size: 1.05rem;
            font-style: italic;
            border: 1px solid #99ccff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .llm-loading {
            text-align: center;
            margin-top: 20px;
            font-style: italic;
            color: #1a4d69;
        }
        .continue-button {
            background-color: #2563eb; /* Blue */
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            margin-top: 20px;
            border: none;
        }
        .continue-button:hover {
            background-color: #1d4ed8;
            transform: translateY(-1px);
        }

        /* Responsive adjustments */
        @media (min-width: 768px) {
            .choices-container {
                flex-direction: row;
                justify-content: center;
                flex-wrap: wrap;
            }
            .choice-button {
                flex-basis: calc(33.333% - 10px); /* Approx 3 buttons per row on larger screens */
                max-width: 280px;
            }
        }

        /* New styles for expanded features */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 20px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.5);
        }
        .stat-display {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #1a4d69;
            font-weight: 600;
            font-size: 0.95rem;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 5px 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .stat-icon {
            font-size: 1.2rem;
        }
        .world-state-display {
            background-color: rgba(255, 255, 255, 0.7);
            padding: 8px 15px;
            border-radius: 12px;
            color: #1a4d69;
            font-weight: 600;
            font-size: 0.95rem;
            margin-top: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .bezen-avatar, .dragon-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #fff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            margin: 0 auto 15px;
            display: block;
        }
        .main-menu-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        .main-menu-button {
            background-color: #2563eb;
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            border: none;
            margin-top: 30px;
        }
        .main-menu-button:hover {
            background-color: #1d4ed8;
            transform: translateY(-2px);
        }
        .game-over-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            color: #1a4d69;
            font-size: 1.8rem;
            font-weight: 700;
        }
        .book-of-wisdom-screen {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-top: 20px;
            text-align: right; /* RTL for text content */
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            display: none; /* Hidden by default */
        }
        .book-of-wisdom-screen h2 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1a4d69;
            margin-bottom: 20px;
            text-align: center;
        }
        .wisdom-entry {
            background-color: #e6f2ff;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            font-size: 1rem;
            color: #333;
            border: 1px solid #cceeff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        .wisdom-entry strong {
            color: #0d47a1;
            font-weight: 700;
            display: block;
            margin-bottom: 5px;
        }
        .book-close-button {
            background-color: #ef4444; /* Red for close */
            margin-top: 20px;
        }
        .book-close-button:hover {
            background-color: #dc2626;
        }
        .gameplay-ui-elements {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
    </style>
</head>
<body onload="initGame()">
    <div class="game-container">
        <!-- Main Menu Screen -->
        <div id="mainMenuScreen" class="main-menu-screen">
            <h1 class="header">××¡×¢ ×”×“×¨×§×•×Ÿ ×”×—×›×: ×©×•××¨×™ ×”×¨×©×ª âœ¨</h1>
            <p class="scene-description">×¦× ×œ××¡×¢ ×‘××§×•×•×™×œ×•× ×”×“×™×’×™×˜×œ×™×ª, ×¢×•×œ× ×©×‘×• ×ª×›×•× ×•×ª ×××•×–× ×•×ª ×”×Ÿ ×”××¤×ª×— ×œ×©×™×— ×‘×¨×™× ×•××•×’×Ÿ ×‘×¨×©×ª. ×”×× ×ª×¦×œ×™×— ×œ×”×™×œ×—× ×‘×‘×¨×™×•× ×•×ª ×•×œ×”×™×•×ª ×©×•××¨ ×¨×©×ª ×××™×ª×™?</p>
            <button class="main-menu-button" onclick="startGame()">×”×ª×—×œ ××¡×¢ ×—×“×©</button>
        </div>

        <!-- Gameplay Screen (Visible after starting game) -->
        <div id="gameplayScreen" style="display: none;">
            <div class="top-bar">
                <div class="stat-display">
                    <span class="stat-icon">ğŸŒŸ</span> × ×§×•×“×•×ª ×—×•×›××”: <span id="wisdomPointsDisplay">0</span>
                </div>
                <div class="stat-display">
                    <span class="stat-icon">ğŸ›¡ï¸</span> ××•××¥: <span id="courageMeterDisplay">50</span>
                </div>
                <div class="stat-display">
                    <span class="stat-icon">ğŸŒ</span> ×”×©×¤×¢×”: <span id="influenceMeterDisplay">50</span>
                </div>
                <button class="continue-button" style="background-color: #5ab0e7; box-shadow: none; margin: 0; padding: 8px 15px; font-size: 0.9rem;" onclick="openBookOfWisdom()">
                    ×¡×¤×¨ ×”×—×•×›××”
                </button>
            </div>
            
            <img src="https://placehold.co/80x80/b0e0ff/333333?text=×“×¨×§×•×Ÿ" alt="×“×¨×§×•×Ÿ" class="dragon-avatar">
            <div id="dilemmaContent">
                <!-- Dilemma content will be loaded here by JavaScript -->
            </div>
            <div class="world-state-display" id="worldStateDisplay"></div>
        </div>

        <!-- Feedback Section (initially hidden) -->
        <div id="feedbackSection" class="feedback-section" style="display: none;">
            <div class="feedback-header" id="feedbackHeader"></div>
            <p id="feedbackText"></p>
            <img src="https://placehold.co/80x80/a0c4ff/333333?text=×‘×–×Ÿ" alt="×‘×–×Ÿ" class="bezen-avatar">
            <p class="bezen-dialogue" id="bezenDialogue">×˜×•×¢×Ÿ ×ª×•×‘× ×•×ª ××‘×–×Ÿ... âœ¨</p>
            <div id="llmLoading" class="llm-loading">×‘×–×Ÿ ×—×•×©×‘ ×¢×œ ×”××™×œ×™× ×”× ×›×•× ×•×ª... âœ¨</div>
            <button class="continue-button" onclick="continueGame()">×”××©×š ×”××¡×¢</button>
        </div>

        <!-- Book of Wisdom Screen -->
        <div id="bookOfWisdomScreen" class="book-of-wisdom-screen">
            <h2>×¡×¤×¨ ×”×—×•×›××” ×©×œ×š</h2>
            <div id="wisdomEntriesContainer">
                <p>×”×¡×¤×¨ ×¢×“×™×™×Ÿ ×¨×™×§. ×‘×¦×¢ ×‘×—×™×¨×•×ª ×××•×–× ×•×ª ×›×“×™ ×œ×¦×‘×•×¨ ×—×•×›××”!</p>
            </div>
            <button class="continue-button book-close-button" onclick="closeBookOfWisdom()">×¡×’×•×¨ ×¡×¤×¨</button>
        </div>

        <!-- Game Over Screen -->
        <div id="gameOverScreen" class="game-over-screen" style="display: none;">
            <p>×”××¡×¢ ×”×¡×ª×™×™×!</p>
            <p id="finalScore"></p>
            <button class="main-menu-button" onclick="location.reload()">×©×—×§ ×©×•×‘</button>
        </div>

    </div>

    <script>
        // Game State
        let gameState = {
            wisdomPoints: 0,
            courageMeter: 50,
            influenceMeter: 50,
            collectedWisdom: [],
            currentSceneIndex: 0
        };
        const apiKey = ""; // Canvas will automatically provide API key if empty

        // Define game scenes/dilemmas
        const allScenes = [
            {
                id: 'scene1_bullying',
                sceneDescription: '×”×“×¨×§×•×Ÿ ×”×¦×¢×™×¨ × ×•×—×ª ×‘"×›×™×›×¨ ×”×©×™×—", ××§×•× ×•×™×¨×˜×•××œ×™ ×©×‘×• ××ª×›× ×¡×™× ××©×ª××©×™ ×¨×©×ª. ×œ×¤×ª×¢, ×¦×œ×œ×™× ×›×”×™× (×—×©×‘×•× ×•×ª ×‘×¨×™×•× ×™×) ××ª×—×™×œ×™× ×œ×”×¤×™×¥ "×”×“×™×" ××‘×™×›×™× ×¡×‘×™×‘ ×™×¦×•×¨ NPC ×§×˜×Ÿ ×•×¤×’×™×¢. ×”"×”×“×™×" ×”×•×¤×›×™× ×œ×§×™×¨×•×ª ×©×œ ×©××•×¢×•×ª, ×—×•×¡××™× ××ª ×“×¨×›×•.',
                dilemmaImage: 'https://placehold.co/400x250/b0e0ff/333333?text=×›×™×›×¨+×”×©×™×—+×”×“×™×’×™×˜×œ×™×ª',
                dilemmaPrompt: '×§×•×œ ×¤× ×™××™ ×œ×•×—×©: "×”×× ×ª×ª×¢×œ× ××–×”, ×ª×¤×¢×œ ×‘×–×”×™×¨×•×ª, ××• ×ª×ª×§×•×£ ×‘×¤×–×™×–×•×ª?"',
                choices: [
                    {
                        type: 'deficient',
                        text: '"×× ×™ ×¤×©×•×˜ ××ª×¢×œ× ××–×”, ××•×œ×™ ×–×” ×™×¢×‘×•×¨ ×œ×‘×“. ×œ××” ×œ×”×¡×ª×‘×š?" (×¤×—×“× ×•×ª)',
                        statChanges: { wisdom: -5, courage: -10, influence: -15 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×œ×”×ª×¢×œ×/×œ×”×™×× ×¢ ××ª×§×™×¤×ª ×‘×¨×™×•× ×•×ª ×‘×¨×©×ª, ×•×”×ª×•×¦××” ×”×™×™×ª×” ×©×œ×™×œ×™×ª (×”×‘×¨×™×•× ×•×ª ×”×—××™×¨×”, ×”× ×¤×’×¢ ×”×™×” ×‘××¦×•×§×”). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×”×©×œ×›×•×ª ×—×•×¡×¨ ×”××¢×© ×•×”×¦×•×¨×š ×œ×”×ª××•×“×“ ×¢× ×¤×—×“. ×¡×™×™× ×‘××¡×¨ ×§×¦×¨ ×•×§×•×œ×¢."
                    },
                    {
                        type: 'beneficial',
                        text: '"××’×© ×‘×–×”×™×¨×•×ª, ××‘×—×Ÿ ××ª ×”××¦×‘ ×•×× ×¡×” ×œ×”×ª×¢×¨×‘ ×‘×—×•×›××”." (××•××¥ ×××•×–×Ÿ)',
                        statChanges: { wisdom: 10, courage: 15, influence: 10 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×‘×¤×¢×•×œ×” ×××•×–× ×ª ×•×××™×¦×” ×‘×ª×¨×—×™×© ×‘×¨×™×•× ×•×ª ×‘×¨×©×ª, ×•×”×ª×•×¦××” ×”×™×™×ª×” ×—×™×•×‘×™×ª (×”×‘×¨×™×•× ×™× × ×¨×ª×¢×•, ×”× ×¤×’×¢ ×—×© ×”×§×œ×”). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×—×©×™×‘×•×ª ×”×¤×¢×•×œ×” ×”×××•×–× ×ª ×•×”×©×œ×›×•×ª×™×” ×”×—×™×•×‘×™×•×ª. ×¡×™×™× ×¢× ××©×¤×˜ ×—×•×›××” ×§×¦×¨ ×•×§×•×œ×¢. ×”×©×ª××© ×‘×©×¤×” ×—×™×•×‘×™×ª ×•××¢×•×“×“×ª."
                    },
                    {
                        type: 'excessive',
                        text: '"××¡×ª×¢×¨ ×¢×œ×™×”× ××™×“ ×¢× × ×©×™××ª ××© ×—×–×§×”! ×©×™×“×¢×• ××™ ×”×‘×•×¡!" (×¤×–×™×–×•×ª)',
                        statChanges: { wisdom: -2, courage: -5, influence: -5 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×‘×¤×¢×•×œ×” ××’×¨×¡×™×‘×™×ª/×¤×–×™×–×” ×‘×ª×¨×—×™×© ×‘×¨×™×•× ×•×ª ×‘×¨×©×ª, ×•×”×ª×•×¦××” ×”×™×™×ª×” ××¢×•×¨×‘×ª/×©×œ×™×œ×™×ª (×”×‘×¨×™×•× ×™× × ×¨×ª×¢×• ××š ×”×’×™×‘×• ×‘×ª×’×•×‘×” × ×’×“×™×ª, ×”× ×¤×’×¢ × ×‘×”×œ ×™×•×ª×¨). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×”×¡×›× ×•×ª ×©×‘×›×•×— ×œ× ××‘×•×§×¨ ×•×¤×¢×•×œ×” ×¤×–×™×–×”. ×¡×™×™× ×‘××¡×¨ ×§×¦×¨ ×•×§×•×œ×¢ ×¢×œ ×—×©×™×‘×•×ª ×”××™×¤×•×§."
                    }
                ]
            },
            {
                id: 'scene2_misinformation',
                sceneDescription: '×”×“×¨×§×•×Ÿ ××’×™×¢ ×œ"××§×“×© ×”××™×“×¢", ×•×¨×•××” ×§×‘×•×¦×ª NPC ××‘×•×œ×‘×œ×™× ×¡×‘×™×‘ ×¢××•×“ ×—×“×©×•×ª ×‘×•×”×§. ×¦×œ×œ×™× ×¢×“×™× ×™× ×™×•×ª×¨ ××¤×™×¦×™× "×–×¨×¢×™ ×©×§×¨" â€“ ××™×“×¢ ××˜×¢×” ×©×’×•×¨× ×œ×ª×•×©×‘×™× ×œ×¤×§×¤×§ ××—×“ ×‘×©× ×™.',
                dilemmaImage: 'https://placehold.co/400x250/a7d9ff/333333?text=××§×“×©+×”××™×“×¢',
                dilemmaPrompt: '×§×•×œ ×¤× ×™××™ ×œ×•×—×©: "×”×× ×ª×ª×¢×œ× ××”××™×“×¢ ×”××˜×¢×”, ×ª×‘×—×Ÿ ××•×ª×• ×œ×¢×•××§, ××• ×ª×¤×™×¥ ××–×”×¨×” ×‘×¤×–×™×–×•×ª?"',
                choices: [
                    {
                        type: 'deficient',
                        text: '"×–×” ×œ× ×¢× ×™×™× ×™, ×©×™×¡×ª×“×¨×• ×œ×‘×“ ×¢× ×”×××ª." (×”×™×× ×¢×•×ª)',
                        statChanges: { wisdom: -3, courage: 0, influence: -10 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×œ×”×ª×¢×œ× ××”×¤×¦×ª ××™×“×¢ ××˜×¢×” ×‘×¨×©×ª, ×•×”×ª×•×¦××” ×”×™×™×ª×” ×©×œ×™×œ×™×ª (×”×ª×•×©×‘×™× ×”××©×™×›×• ×œ×¤×§×¤×§, ×”×××•×Ÿ × ×¡×“×§). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×”×©×œ×›×•×ª ×”×”×ª×¢×œ××•×ª ×××™×“×¢ ×©×§×¨×™ ×•×”× ×–×§ ×œ×××•×Ÿ ×”×§×”×™×œ×”. ×¡×™×™× ×‘××¡×¨ ×§×¦×¨ ×•×§×•×œ×¢."
                    },
                    {
                        type: 'beneficial',
                        text: '"××‘×“×•×§ ××ª ××§×•×¨ ×”××™×“×¢ ×‘×§×¤×™×“×” ×œ×¤× ×™ ×©××’×™×‘." (×©×™×§×•×œ ×“×¢×ª ×××•×–×Ÿ)',
                        statChanges: { wisdom: 12, courage: 5, influence: 8 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×œ×‘×“×•×§ ××™×“×¢ ××˜×¢×” ×‘×§×¤×™×“×”, ×•×”×ª×•×¦××” ×”×™×™×ª×” ×—×™×•×‘×™×ª (×”×××ª × ×—×©×¤×”, ×”×××•×Ÿ ×”×ª×—×–×§). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×—×©×™×‘×•×ª ×”××™××•×ª ×•×©×™×§×•×œ ×”×“×¢×ª ×‘×¢×™×“×Ÿ ×”××™×“×¢. ×¡×™×™× ×¢× ××©×¤×˜ ×—×•×›××” ×§×¦×¨ ×•×§×•×œ×¢. ×”×©×ª××© ×‘×©×¤×” ×—×™×•×‘×™×ª ×•××¢×•×“×“×ª."
                    },
                    {
                        type: 'excessive',
                        text: '"××¤×™×¥ ××–×”×¨×” ××™×™×“×™×ª ×œ×›×•×œ×, ×‘×œ×™ ×œ×‘×“×•×§ ×¤×¢××™×™×!" (×¤×–×™×–×•×ª)',
                        statChanges: { wisdom: -5, courage: 5, influence: -12 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×œ×”×¤×™×¥ ××–×”×¨×” ×‘×¤×–×™×–×•×ª ××‘×œ×™ ×œ×‘×“×•×§ ××™×“×¢, ×•×”×ª×•×¦××” ×”×™×™×ª×” ×©×œ×™×œ×™×ª (×”×‘×”×œ×” ×’×“×œ×”, ×”×××•×Ÿ × ×¤×’×¢). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×”×¡×›× ×•×ª ×©×‘×¤×¢×•×œ×” ×œ×œ× ××™××•×ª ××”×™×¨ ×•×”× ×–×§ ×œ×©×™×— ×”×¦×™×‘×•×¨×™. ×¡×™×™× ×‘××¡×¨ ×§×¦×¨ ×•×§×•×œ×¢ ×¢×œ ×—×©×™×‘×•×ª ×”××™×¤×•×§ ×•×”×‘×“×™×§×”."
                    }
                ]
            },
            {
                id: 'scene3_cyberbullying_victim',
                sceneDescription: '×”×“×¨×§×•×Ÿ × ×ª×§×œ ×‘-NPC ×‘×©× ×œ×™×œ×™, ×™×¦×•×¨ ×§×˜×Ÿ ×•××¤×•×—×“, ×”×™×•×©×‘×ª ×‘×¤×™× ×” ×—×©×•×›×” ×©×œ "×›×¤×¨ ×”×‘×™×™×©× ×™×" ×”×“×™×’×™×˜×œ×™. ×¡×‘×™×‘×” ××¨×—×¤×™× "×§×•×¨×™ ×‘×•×©×”" â€“ ×”×•×“×¢×•×ª ×¤×¨×˜×™×•×ª ××©×¤×™×œ×•×ª ×©× ×©×œ×—×• ××œ×™×”. ×”×™× ×œ×•×—×©×ª, "×× ×™ ×¤×©×•×˜ ××¢×œ× ××”×¨×©×ª... ×–×” ×”×“×‘×¨ ×”×™×—×™×“ ×©××•×›×œ ×œ×¢×©×•×ª."',
                dilemmaImage: 'https://placehold.co/400x250/d2e7ff/333333?text=×œ×™×œ×™+×‘××¦×•×§×”',
                dilemmaPrompt: '×§×•×œ ×¤× ×™××™ ×œ×•×—×©: "×”×× ×ª×ª×¢×œ× ××›××‘×”, ×ª×¤×¢×œ ×œ×”×¦×™×¢ ×ª××™×›×”, ××• ×ª×ª×§×•×£ ××ª ×”×‘×¨×™×•× ×™× ×™×©×™×¨×•×ª?"',
                choices: [
                    {
                        type: 'deficient',
                        text: '"×–×” ×¢× ×™×™×Ÿ ×©×œ×”, ×œ× ×©×œ×™. ××•×œ×™ ×¢×“×™×£ ×œ×”×©××™×¨ ××•×ª×” ×œ×‘×“." (××“×™×©×•×ª)',
                        statChanges: { wisdom: -8, courage: -5, influence: -10 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×œ×”×ª×¢×œ× ××›××‘×” ×©×œ ×§×•×¨×‘×Ÿ ×‘×¨×™×•× ×•×ª ×‘×¨×©×ª, ×•×”×ª×•×¦××” ×”×™×™×ª×” ×©×œ×™×œ×™×ª (×”×§×•×¨×‘×Ÿ ×”×ª×›× ×¡×” ×™×•×ª×¨, ×”×‘×¢×™×” × ××©×›×”). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×”×©×œ×›×•×ª ×”××“×™×©×•×ª ×•×—×©×™×‘×•×ª ×”×××¤×ª×™×” ×•××ª×Ÿ ×ª××™×›×” ×œ× ×¤×’×¢×™×. ×¡×™×™× ×‘××¡×¨ ×§×¦×¨ ×•×§×•×œ×¢."
                    },
                    {
                        type: 'beneficial',
                        text: '"××¦×™×¢ ×œ×œ×™×œ×™ ×ª××™×›×” ×•××¡×™×™×¢ ×œ×” ×œ××¦×•× ×¢×–×¨×” ×‘×˜×•×—×”." (×××¤×ª×™×” ×•××•××¥ ×××•×–×Ÿ)',
                        statChanges: { wisdom: 15, courage: 10, influence: 12 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×œ×”×¦×™×¢ ×ª××™×›×” ×•×œ×¡×™×™×¢ ×œ×§×•×¨×‘×Ÿ ×‘×¨×™×•× ×•×ª ×‘×¨×©×ª, ×•×”×ª×•×¦××” ×”×™×™×ª×” ×—×™×•×‘×™×ª (×”×§×•×¨×‘×Ÿ ×—×©×” ×”×§×œ×”, ×“×¨×š ×œ×¢×–×¨×” × ×¤×ª×—×”). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×—×©×™×‘×•×ª ×”×××¤×ª×™×”, ×”××•××¥ ×œ×”×•×©×™×˜ ×™×“, ×•×”×”×©×¤×¢×” ×”××¨×¤××ª ×©×œ ×ª××™×›×”. ×¡×™×™× ×¢× ××©×¤×˜ ×—×•×›××” ×§×¦×¨ ×•×§×•×œ×¢. ×”×©×ª××© ×‘×©×¤×” ×—×™×•×‘×™×ª ×•××¢×•×“×“×ª."
                    },
                    {
                        type: 'excessive',
                        text: '"×××¦× ××ª ×”×‘×¨×™×•× ×™× ×•××ª×§×•×£ ××•×ª× ×™×©×™×¨×•×ª, ×‘×œ×™ ×œ×—×©×•×‘ ×¢×œ ×œ×™×œ×™." (× ×§×× ×•×ª ×¤×–×™×–×”)',
                        statChanges: { wisdom: -10, courage: 5, influence: -8 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×œ×ª×§×•×£ ×‘×¨×™×•× ×™× ×™×©×™×¨×•×ª, ×•×”×ª×•×¦××” ×”×™×™×ª×” ××¢×•×¨×‘×ª/×©×œ×™×œ×™×ª (×”×‘×¨×™×•× ×™× ××•×œ×™ × ×¨×ª×¢×• ××š ×”×’×™×‘×• ×‘××œ×™××•×ª, ×”×§×•×¨×‘×Ÿ ×—×©×” ×—×¨×“×” × ×•×¡×¤×ª). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×”×¡×›× ×•×ª ×©×‘× ×§×× ×•×ª ×•×‘×¤×¢×•×œ×” ×œ×œ× ×”×ª×—×©×‘×•×ª ×‘×§×•×¨×‘×Ÿ ×•×‘×ª×•×¦××•×ª ××¨×•×›×•×ª ×”×˜×•×•×—. ×¡×™×™× ×‘××¡×¨ ×§×¦×¨ ×•×§×•×œ×¢ ×¢×œ ×—×©×™×‘×•×ª ×”×’×™×©×” ×”×”×•×œ×™×¡×˜×™×ª ×•×”×©×§×•×œ×”."
                    }
                ]
            },
            {
                id: 'scene4_bully_justification',
                sceneDescription: '×”×“×¨×§×•×Ÿ ××ª×§×¨×‘ ×œ×§×‘×•×¦×ª "×™×•×¦×¨×™ ×¨×¢×©" (×‘×¨×™×•× ×™×) ×‘×”×¨×™ ×”×”×¤×¨×–×”. ××—×“ ××”×, ×˜×™×™×¤×•×Ÿ ×”×©×¨×™×¨×™, ××ª×¨×‘×¨×‘: "×”×•× ×”×ª×—×™×œ! ××’×™×¢ ×œ×•! ×–×” ×¨×§ ×‘×¦×—×•×§, ××” ×”×•× ×œ×•×§×— ×§×©×”?"',
                dilemmaImage: 'https://placehold.co/400x250/ffd7a7/333333?text=×‘×¨×™×•× ×™×+××ª×¨×‘×¨×‘×™×',
                dilemmaPrompt: '×§×•×œ ×¤× ×™××™ ×œ×•×—×©: "×”×× ×ª×ª××•×š ×‘×‘×¨×™×•× ×™×, ×ª××ª×’×¨ ××ª ×”×”×¦×“×§×” ×©×œ×”×, ××• ×ª×ª×§×•×£ ××•×ª× ×‘×—××ª ×–×¢×?"',
                choices: [
                    {
                        type: 'deficient',
                        text: '"×›×Ÿ, ×”×•× ×‘×××ª ×”×ª×—×™×œ. ××’×™×¢ ×œ×•." (×§×•× ×¤×•×¨××™×•×ª)',
                        statChanges: { wisdom: -10, courage: -5, influence: -15 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×œ×ª××•×š ×‘×‘×¨×™×•× ×™× ×•×‘××¢×©×™×”× ×‘×¨×©×ª, ×•×”×ª×•×¦××” ×”×™×™×ª×” ×©×œ×™×œ×™×ª (×”×‘×¨×™×•× ×™× ×”×ª×—×–×§×•, ×”×”×©×¤×¢×” ×”×©×œ×™×œ×™×ª ×’×‘×¨×”). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×”×¡×›× ×•×ª ×©×‘×§×•× ×¤×•×¨××™×•×ª ×•×‘××™-×œ×§×™×—×ª ××—×¨×™×•×ª ××™×©×™×ª, ×•×›×™×¦×“ ×”×™× ××—×–×§×ª ×”×ª× ×”×’×•×ª ×¤×•×’×¢× ×™×ª. ×¡×™×™× ×‘××¡×¨ ×§×¦×¨ ×•×§×•×œ×¢."
                    },
                    {
                        type: 'beneficial',
                        text: '"×¤×’×™×¢×” ××™×œ×•×œ×™×ª ××™× ×” ×¦×—×•×§. ×”×× ×ª×¨×¦×” ×©××™×©×”×• ×™×¤×’×¢ ×›×š ×‘×š?" (××ª×’×•×¨ ××—×•×©×‘)',
                        statChanges: { wisdom: 18, courage: 12, influence: 15 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×œ××ª×’×¨ ××ª ×”×¦×“×§×ª ×”×‘×¨×™×•× ×™× ×‘×©×™×— ×¨×¦×™×•× ×œ×™ ×•××—×•×©×‘, ×•×”×ª×•×¦××” ×”×™×™×ª×” ×—×™×•×‘×™×ª (×”×‘×¨×™×•× ×™× ×”×ª×‘×œ×‘×œ×•, ×—×œ×§× ×¤×§×¤×§×• ×‘×¢×¦××, ×”×”×©×¤×¢×” ×”×—×™×•×‘×™×ª ×’×‘×¨×”). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×›×•×—×” ×©×œ ×”×××ª ×•×”××•××¥ ×œ×”×ª×¢××ª ×¢× ×”×©×§×¨, ×•×›×™×¦×“ ×©×™×— ×××•×–×Ÿ ×™×›×•×œ ×œ×¤×–×¨ ××ª ×”××©×œ×™×”. ×¡×™×™× ×¢× ××©×¤×˜ ×—×•×›××” ×§×¦×¨ ×•×§×•×œ×¢. ×”×©×ª××© ×‘×©×¤×” ×—×™×•×‘×™×ª ×•××¢×•×“×“×ª."
                    },
                    {
                        type: 'excessive',
                        text: '"××ª× ××¤×œ×¦×•×ª! ×ª×©×œ××• ×¢×œ ×–×” ×¢×›×©×™×•!" (×”×ª×§×¤×” ××™××¤×•×œ×¡×™×‘×™×ª)',
                        statChanges: { wisdom: -5, courage: -10, influence: -10 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×œ×ª×§×•×£ ××ª ×”×‘×¨×™×•× ×™× ×‘×—××ª ×–×¢× ×•×œ×œ× ××—×©×‘×”, ×•×”×ª×•×¦××” ×”×™×™×ª×” ×©×œ×™×œ×™×ª (×”×‘×¨×™×•× ×™× ×”×ª×‘×¦×¨×• ×™×•×ª×¨, ×”×©×™×— ×”×¤×š ×œ××œ×™×). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×”×¡×›× ×•×ª ×©×‘×ª×’×•×‘×” ××™××¤×•×œ×¡×™×‘×™×ª, ×•×›×™×¦×“ ××œ×™××•×ª ×¨×§ ××•×œ×™×“×” ××œ×™××•×ª × ×•×¡×¤×ª, ×‘××§×•× ×œ×¤×ª×•×¨ ××ª ×”×‘×¢×™×”. ×¡×™×™× ×‘××¡×¨ ×§×¦×¨ ×•×§×•×œ×¢ ×¢×œ ×—×©×™×‘×•×ª ×”××™×¤×•×§ ×•×”×ª×’×•×‘×” ×”××•×©×›×œ×ª."
                    }
                ]
            },
            {
                id: 'scene5_peer_pressure',
                sceneDescription: '×”×“×¨×§×•×Ÿ ××’×™×¢ ×œ"×¦×•××ª ×”×œ×—×¥ ×”×—×‘×¨×ª×™" ×•×¨×•××” ×§×‘×•×¦×ª ×“×¨×§×•× ×™× ×¦×¢×™×¨×™× ×©××©×›× ×¢×ª NPC ×—×œ×© ×™×•×ª×¨, ×‘×©× ×“×•×ª×Ÿ, ×œ×”×¤×™×¥ "×–×¨×¢×™ ×›×¢×¡" (×¤×•×¡×˜×™× ×¤×•×’×¢× ×™×™×) ×‘×§×‘×•×¦×” ××§×•×•× ×ª. ××—×“ ××”× ××•××¨: "×›×•×œ× ×¢×•×©×™× ××ª ×–×”, ×“×•×ª×Ÿ! ×× ×œ× ×ª×¦×˜×¨×£, ×ª×”×™×” ××—×•×¥ ×œ×—×‘×•×¨×”!"',
                dilemmaImage: 'https://placehold.co/400x250/c0d7ff/333333?text=×œ×—×¥+×—×‘×¨×ª×™+×‘×¨×©×ª',
                dilemmaPrompt: '×§×•×œ ×¤× ×™××™ ×œ×•×—×©: "×”×× ×ª×ª××•×š ×‘×œ×—×¥ ×”×—×‘×¨×ª×™, ×ª×ª× ×’×“ ×œ×• ×‘×—×•×›××”, ××• ×ª×ª×§×•×£ ××ª ×›×•×œ× ×‘×¤×¨××•×ª?"',
                choices: [
                    {
                        type: 'deficient',
                        text: '"×”× ×¦×•×“×§×™×, ×“×•×ª×Ÿ ×¦×¨×™×š ×œ×”×©×ª×œ×‘. ××™×Ÿ ××” ×œ×¢×©×•×ª." (×§×•× ×¤×•×¨××™×•×ª ×¤×¡×™×‘×™×ª)',
                        statChanges: { wisdom: -12, courage: -10, influence: -15 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×œ×ª××•×š ×‘×œ×—×¥ ×—×‘×¨×ª×™ ×©×œ×™×œ×™ ×‘×¨×©×ª, ×•×”×ª×•×¦××” ×”×™×™×ª×” ×©×œ×™×œ×™×ª (×“×•×ª×Ÿ × ×›× ×¢, ×”×©×™×— ×”×¤×š ×¨×¢×™×œ, ×”×‘×¨×™×•× ×•×ª ×”×ª×—×–×§×”). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×”×¡×›× ×•×ª ×©×‘×§×•× ×¤×•×¨××™×•×ª ×œ×œ×—×¥ ×©×œ×™×œ×™, ×•×›×™×¦×“ ×”×™× ××—×œ×™×©×” ××ª ×”×¤×¨×˜ ×•×¤×•×’×¢×ª ×‘×§×”×™×œ×”. ×¡×™×™× ×‘××¡×¨ ×§×¦×¨ ×•×§×•×œ×¢."
                    },
                    {
                        type: 'beneficial',
                        text: '"×œ×—×¥ ×—×‘×¨×ª×™ ×œ× ××¦×“×™×§ ×¤×’×™×¢×”. ×œ×“×•×ª×Ÿ ×™×© ×‘×—×™×¨×” ×—×•×¤×©×™×ª ×œ×¤×¢×•×œ × ×›×•×Ÿ." (×¢××™×“×” ××™×ª× ×” ×•××•××¥ ×××•×–×Ÿ)',
                        statChanges: { wisdom: 20, courage: 18, influence: 20 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×œ×”×ª× ×’×“ ×œ×œ×—×¥ ×—×‘×¨×ª×™ ×©×œ×™×œ×™ ×‘×¨×©×ª ×‘×—×•×›××”, ×•×”×ª×•×¦××” ×”×™×™×ª×” ×—×™×•×‘×™×ª (×“×•×ª×Ÿ ×§×™×‘×œ ××•××¥, ×”×œ×—×¥ ×”×ª×¤×–×¨, ×”×©×™×— ×”×©×ª×¤×¨). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×›×•×—×” ×©×œ ×¢××™×“×” ××™×ª× ×” ×•××•××¥ ××•×¡×¨×™, ×•×›×™×¦×“ ×”×™× ××¢× ×™×§×” ×”×©×¨××” ×•××©×—×¨×¨×ª ××—×¨×™×. ×¡×™×™× ×¢× ××©×¤×˜ ×—×•×›××” ×§×¦×¨ ×•×§×•×œ×¢. ×”×©×ª××© ×‘×©×¤×” ×—×™×•×‘×™×ª ×•××¢×•×“×“×ª."
                    },
                    {
                        type: 'excessive',
                        text: '"××˜×¤×œ ×‘×›×•×œ× ×‘×‘×ª ××—×ª! ××£ ××—×“ ×œ× ×™×›×¨×™×— ××£ ××—×“ ×œ×¤×’×•×¢!" (×›×•×—× ×•×ª ××™××¤×•×œ×¡×™×‘×™×ª)',
                        statChanges: { wisdom: -8, courage: -5, influence: -10 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×œ×ª×§×•×£ ×‘×—××ª ×–×¢× ××ª ×›×œ ××™ ×©×”×¤×¢×™×œ ×œ×—×¥ ×—×‘×¨×ª×™ ×©×œ×™×œ×™ ×‘×¨×©×ª, ×•×”×ª×•×¦××” ×”×™×™×ª×” ×©×œ×™×œ×™×ª (×”×œ×—×¥ ×”×ª×¤×–×¨ ×–×× ×™×ª ××š ×”×•×—×œ×£ ×‘×¤×—×“, ×œ× ×‘×œ××™×“×”). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×”×¡×›× ×•×ª ×©×‘×›×•×—× ×•×ª, ×•×›×™×¦×“ ×”×™× ××™× ×” ××œ××“×ª ×©×™×¢×•×¨ ××œ× ×™×•×¦×¨×ª ×”×ª× ×’×“×•×ª × ×•×¡×¤×ª. ×¡×™×™× ×‘××¡×¨ ×§×¦×¨ ×•×§×•×œ×¢ ×¢×œ ×—×©×™×‘×•×ª ×”×’×™×©×” ×”×—×™× ×•×›×™×ª ×•×”×××•×–× ×ª."
                    }
                ]
            },
            {
                id: 'scene6_anonymity_abuse',
                sceneDescription: '×”×“×¨×§×•×Ÿ ××’×™×¢ ×œ"××¢×¨×ª ×”×× ×•× ×™××™×•×ª", ××§×•× ××¤×œ ×•× ×¡×ª×¨ ×‘×¨×©×ª. ×¦×œ×œ×™× ×—×¡×¨×™ ×¤× ×™× (×—×©×‘×•× ×•×ª ×× ×•× ×™××™×™×) ××¤×™×¦×™× ×©× "×¨×¢×œ ×©×§×˜" â€“ ×”×•×“×¢×•×ª ×¤×•×’×¢× ×™×•×ª ×œ×œ× ×–×™×”×•×™, ×•×”× ×—×©×™× ××•×’× ×™× ×‘×›×¡×•×ª ×”×× ×•× ×™××™×•×ª. ××—×“ ×”×¦×œ×œ×™× ×œ×•×—×©: "××£ ××—×“ ×œ× ×™×™×“×¢ ×©×–×” ×× ×™..."',
                dilemmaImage: 'https://placehold.co/400x250/a0a0a0/ffffff?text=××¢×¨×ª+×”×× ×•× ×™××™×•×ª',
                dilemmaPrompt: '×§×•×œ ×¤× ×™××™ ×œ×•×—×©: "×”×× ×ª×ª×¢×œ× ××›×™×•×•×Ÿ ×©×”× ×× ×•× ×™××™×™×, ×ª× ×¡×” ×œ×—×©×•×£ ××•×ª× ×‘×—×•×›××”, ××• ×ª×ª×§×•×£ ××ª ×”××¢×¨×” ×‘×¤×¨××•×ª?"',
                choices: [
                    {
                        type: 'deficient',
                        text: '"××™×Ÿ ××” ×œ×¢×©×•×ª, ×”× ×× ×•× ×™××™×™×. ××™ ××¤×©×¨ ×œ×”×ª××•×“×“ ×¢× ×–×”." (×™×™××•×© ×•×”×©×œ××”)',
                        statChanges: { wisdom: -10, courage: -8, influence: -15 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×œ×”×ª×™×™××© ××•×œ ×‘×¨×™×•× ×•×ª ×× ×•× ×™××™×ª ×‘×¨×©×ª, ×•×”×ª×•×¦××” ×”×™×™×ª×” ×©×œ×™×œ×™×ª (×”×‘×¨×™×•× ×•×ª × ××©×›×” ×œ×œ× ×”×¤×¨×¢×”, ×”×××•×Ÿ × ×¤×’×¢). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×”×¡×›× ×•×ª ×©×‘×™×™××•×© ××•×œ ××ª×’×¨×™× ×× ×•× ×™××™×™×, ×•×›×™×¦×“ ×’× ××•×œ ×—×•×¡×¨ ×–×”×•×ª ×™×© ×“×¨×›×™× ×œ×¤×¢×•×œ. ×¡×™×™× ×‘××¡×¨ ×§×¦×¨ ×•×§×•×œ×¢."
                    },
                    {
                        type: 'beneficial',
                        text: '"×’× ×× ×•× ×™××™×•×ª ××™× ×” ×”×’× ×” ××•×—×œ×˜×ª. ×× ×¡×” ×œ×–×”×•×ª ×“×¤×•×¡×™× ×•×œ×—×©×•×£ ××ª ×”×××ª ×‘×“×¨×›×™× × ×‘×•× ×•×ª." (×©×™×§×•×œ ×“×¢×ª ×•×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª)',
                        statChanges: { wisdom: 25, courage: 15, influence: 20 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×œ×–×”×•×ª ×“×¤×•×¡×™× ×•×œ×—×©×•×£ ×‘×¨×™×•× ×•×ª ×× ×•× ×™××™×ª ×‘×—×•×›××”, ×•×”×ª×•×¦××” ×”×™×™×ª×” ×—×™×•×‘×™×ª (×”×× ×•× ×™××™×™× × ×—×©×¤×• ××• × ×¨×ª×¢×•, ×”×××•×Ÿ ×”×ª×—×–×§). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×—×©×™×‘×•×ª ×©×™×§×•×œ ×”×“×¢×ª, ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª ×™×¦×™×¨×ª×™, ×•×›×™×¦×“ ×’× ××•×œ ×× ×•× ×™××™×•×ª × ×™×ª×Ÿ ×œ×—×©×•×£ ××ª ×”×××ª ×•×œ×”×‘×™× ×œ××—×¨×™×•×ª. ×¡×™×™× ×¢× ××©×¤×˜ ×—×•×›××” ×§×¦×¨ ×•×§×•×œ×¢. ×”×©×ª××© ×‘×©×¤×” ×—×™×•×‘×™×ª ×•××¢×•×“×“×ª."
                    },
                    {
                        type: 'excessive',
                        text: '"××©×¨×•×£ ××ª ×”××¢×¨×” ×›×•×œ×”! ××£ ××—×“ ×œ× ×™×™×©××¨ ×× ×•× ×™××™ ×›×“×™ ×œ×¤×’×•×¢!" (×ª×’×•×‘×” ×§×™×¦×•× ×™×ª ×•××œ×™××”)',
                        statChanges: { wisdom: -15, courage: -10, influence: -10 },
                        prompt: "×”×©×—×§×Ÿ ×‘×—×¨ ×œ×ª×§×•×£ ×‘××œ×™××•×ª ×§×™×¦×•× ×™×ª ××ª ××§×•×¨ ×”×‘×¨×™×•× ×•×ª ×”×× ×•× ×™××™×ª ×‘×¨×©×ª, ×•×”×ª×•×¦××” ×”×™×™×ª×” ×©×œ×™×œ×™×ª (×”×‘×¢×™×” ×œ× × ×¤×ª×¨×” ××œ× × ×•×¦×¨×• ×‘×¢×™×•×ª ×—×“×©×•×ª, ×™×™××•×© ×›×œ×œ×™). ×¦×•×¨ ××—×©×‘×” ×§×¦×¨×”, ××¢××™×§×” ×•××œ××ª ×ª×•×‘× ×•×ª ××“××•×ª ×× ×˜×•×¨ ×—×›× (×‘×–×Ÿ) ×¢×œ ×‘×—×™×¨×” ×–×•, ×ª×•×š ×”×“×’×©×ª ×”×¡×›× ×•×ª ×©×‘×ª×’×•×‘×” ×§×™×¦×•× ×™×ª ×•×œ× ××‘×•×§×¨×ª, ×•×›×™×¦×“ ×”×™× ×’×•×¨××ª ×™×•×ª×¨ × ×–×§ ××ª×•×¢×œ×ª, ×•××™× ×” ×¤×•×ª×¨×ª ××ª ×©×•×¨×© ×”×‘×¢×™×”. ×¡×™×™× ×‘××¡×¨ ×§×¦×¨ ×•×§×•×œ×¢ ×¢×œ ×—×©×™×‘×•×ª ×”×’×™×©×” ×”××•×¨×›×‘×ª ×•×”×¡×‘×œ× ×•×ª."
                    }
                ]
            }
        ];


        // Initialize game on window load
        function initGame() {
            showScreen('mainMenuScreen');
        }

        // Function to show specific screen and hide others
        function showScreen(screenId) {
            document.getElementById('mainMenuScreen').style.display = 'none';
            document.getElementById('gameplayScreen').style.display = 'none';
            document.getElementById('feedbackSection').style.display = 'none';
            document.getElementById('bookOfWisdomScreen').style.display = 'none';
            document.getElementById('gameOverScreen').style.display = 'none';

            document.getElementById(screenId).style.display = 'flex'; // Use flex for centering content
            if (screenId === 'gameplayScreen') {
                document.getElementById(screenId).style.flexDirection = 'column';
                document.getElementById(screenId).style.alignItems = 'center';
            }
        }

        // Start the game
        function startGame() {
            // Reset game state for a new game
            gameState = {
                wisdomPoints: 0,
                courageMeter: 50,
                influenceMeter: 50,
                collectedWisdom: [],
                currentSceneIndex: 0
            };
            updateStatsDisplay();
            updateWorldStateDisplay();
            loadScene(gameState.currentSceneIndex);
            showScreen('gameplayScreen');
        }

        // Load a specific scene
        function loadScene(sceneIndex) {
            if (sceneIndex >= allScenes.length) {
                showGameOverScreen();
                return;
            }

            const currentSceneData = allScenes[sceneIndex];
            const dilemmaContent = document.getElementById('dilemmaContent');

            // Clear previous dilemma content
            dilemmaContent.innerHTML = '';

            // Create and append scene description
            const sceneDescriptionDiv = document.createElement('div');
            sceneDescriptionDiv.className = 'scene-description';
            sceneDescriptionDiv.innerHTML = `<p>${currentSceneData.sceneDescription}</p>`;
            dilemmaContent.appendChild(sceneDescriptionDiv);

            // Create and append dilemma image
            const dilemmaImage = document.createElement('img');
            dilemmaImage.src = currentSceneData.dilemmaImage;
            dilemmaImage.alt = currentSceneData.id;
            dilemmaImage.className = 'dilemma-image';
            dilemmaContent.appendChild(dilemmaImage);

            // Create and append dilemma prompt
            const dilemmaPrompt = document.createElement('p');
            dilemmaPrompt.className = 'dilemma-prompt';
            dilemmaPrompt.textContent = currentSceneData.dilemmaPrompt;
            dilemmaContent.appendChild(dilemmaPrompt);

            // Create and append choices container
            const choicesContainer = document.createElement('div');
            choicesContainer.className = 'choices-container';
            currentSceneData.choices.forEach(choice => {
                const button = document.createElement('button');
                button.className = `choice-button ${choice.type}`;
                button.textContent = choice.text;
                button.onclick = () => makeChoice(choice.type, currentSceneData.id); // Pass scene ID for context
                choicesContainer.appendChild(button);
            });
            dilemmaContent.appendChild(choicesContainer);

            // Hide feedback section if visible
            document.getElementById('feedbackSection').style.display = 'none';
            document.getElementById('gameplayScreen').style.display = 'flex'; // Ensure gameplay screen is visible
        }

        // Function to update player stats display
        function updateStatsDisplay() {
            document.getElementById('wisdomPointsDisplay').textContent = gameState.wisdomPoints;
            document.getElementById('courageMeterDisplay').textContent = gameState.courageMeter;
            document.getElementById('influenceMeterDisplay').textContent = gameState.influenceMeter;

            // Clamp meters to 0-100 for visual consistency
            gameState.courageMeter = Math.max(0, Math.min(100, gameState.courageMeter));
            gameState.influenceMeter = Math.max(0, Math.min(100, gameState.influenceMeter));
        }

        // Function to update world state based on influence
        function updateWorldStateDisplay() {
            const worldStateDisplay = document.getElementById('worldStateDisplay');
            let stateText = '××§×•×•×™×œ×•× ×”×“×™×’×™×˜×œ×™×ª × ××¦××ª ×‘××¦×‘... ';

            if (gameState.influenceMeter >= 80) {
                stateText += '×¤×¨×™×—×” ×•×©×’×©×•×’! ğŸŒ¸âœ¨';
            } else if (gameState.influenceMeter >= 60) {
                stateText += '×”×¨××•× ×™×” ×•×™×¦×™×‘×•×ª.  ';
            } else if (gameState.influenceMeter >= 40) {
                stateText += '××™×–×•×Ÿ ××¢×•×¨×¢×¨. ğŸŒ«ï¸';
            } else if (gameState.influenceMeter >= 20) {
                stateText += '×§×©×™×™× ×•×¡×›×¡×•×›×™×. ğŸ’¢';
            } else {
                stateText += '×›××•×¡ ×•×¨×¢×™×œ×•×ª! ğŸ’€';
            }
            worldStateDisplay.textContent = stateText;
        }

        // Function to handle player choice
        async function makeChoice(choiceType, sceneId) {
            const currentSceneData = allScenes.find(scene => scene.id === sceneId);
            const chosenOption = currentSceneData.choices.find(choice => choice.type === choiceType);

            // Disable buttons to prevent multiple clicks while LLM is processing
            document.querySelectorAll('.choice-button').forEach(button => {
                button.disabled = true;
                button.style.opacity = 0.7;
                button.style.cursor = 'not-allowed';
            });

            // Update game stats
            gameState.wisdomPoints += chosenOption.statChanges.wisdom;
            gameState.courageMeter += chosenOption.statChanges.courage;
            gameState.influenceMeter += chosenOption.statChanges.influence;
            updateStatsDisplay();
            updateWorldStateDisplay();

            // Prepare feedback section
            document.getElementById('gameplayScreen').style.display = 'none';
            document.getElementById('feedbackSection').style.display = 'block';
            document.getElementById('feedbackHeader').textContent = `×ª×•×¦××ª ×”×‘×—×™×¨×”: ${chosenOption.type === 'deficient' ? '×—×¡×¨×•× ×™' : chosenOption.type === 'beneficial' ? '××•×¢×™×œ' : '××•×’×–×'}`;
            document.getElementById('feedbackText').textContent = `×”×“×¨×§×•×Ÿ ×‘×—×¨: "${chosenOption.text}". ${getOutcomeText(choiceType)}`;
            document.getElementById('bezenDialogue').textContent = "×˜×•×¢×Ÿ ×ª×•×‘× ×•×ª ××‘×–×Ÿ... âœ¨";
            document.getElementById('llmLoading').style.display = 'block';

            let aiResponseText = '';
            let wisdomStatement = '';

            try {
                // LLM API call
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: chosenOption.prompt }] });
                const payload = { contents: chatHistory };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    aiResponseText = result.candidates[0].content.parts[0].text;
                    document.getElementById('bezenDialogue').textContent = "×‘×–×Ÿ: " + aiResponseText;

                    if (choiceType === 'beneficial') {
                        const sentences = aiResponseText.split('.');
                        if (sentences.length > 1) { // Ensure there are at least two sentences
                            wisdomStatement = sentences[sentences.length - 2].trim() + '.';
                            gameState.collectedWisdom.push({ scene: currentSceneData.sceneDescription, wisdom: wisdomStatement });
                            console.log("New Wisdom Acquired: " + wisdomStatement);
                        }
                    }
                } else {
                    aiResponseText = "×œ× ×”×¦×œ×—×ª×™ ×œ×”×ª×—×‘×¨ ×œ×ª×•×‘× ×•×ª ×¢××•×§×•×ª ×›×¨×’×¢, ××š ×”××¡×¨ ×‘×¨×•×¨.";
                    document.getElementById('bezenDialogue').textContent = "×‘×–×Ÿ: " + aiResponseText;
                    console.error("LLM response structure unexpected:", result);
                }
            } catch (error) {
                console.error("Error calling LLM API:", error);
                aiResponseText = "× ×¨××” ×©×™×© ×”×¤×¨×¢×” ×‘×§×©×¨, ××š ×–×›×•×¨ ××ª ×”×œ×§×—!";
                document.getElementById('bezenDialogue').textContent = "×‘×–×Ÿ: " + aiResponseText;
            } finally {
                document.getElementById('llmLoading').style.display = 'none';
            }
        }

        // Helper function to get descriptive outcome text (can be expanded)
        function getOutcomeText(choiceType) {
            switch (choiceType) {
                case 'deficient': return '×”×ª×•×¦××” ×”×™×™×ª×” ×©×œ×™×œ×™×ª ×•×”×—××™×¨×” ××ª ×”××¦×‘.';
                case 'beneficial': return '×”×ª×•×¦××” ×”×™×™×ª×” ×—×™×•×‘×™×ª ×•×§×™×“××” ××ª ×”××™×–×•×Ÿ.';
                case 'excessive': return '×”×ª×•×¦××” ×”×™×™×ª×” ××¢×•×¨×‘×ª ×•×œ×¢×™×ª×™× ××£ ×”×—××™×¨×” ××ª ×”××¦×‘.';
                default: return '';
            }
        }

        // Function to continue to next scene or end game
        function continueGame() {
            gameState.currentSceneIndex++;
            if (gameState.currentSceneIndex < allScenes.length) {
                loadScene(gameState.currentSceneIndex);
                showScreen('gameplayScreen');
                // Re-enable buttons for the next scene
                document.querySelectorAll('.choice-button').forEach(button => {
                    button.disabled = false;
                    button.style.opacity = 1;
                    button.style.cursor = 'pointer';
                });
            } else {
                showGameOverScreen();
            }
        }

        // Show Game Over screen
        function showGameOverScreen() {
            document.getElementById('finalScore').textContent = `× ×§×•×“×•×ª ×—×•×›××” ×¡×•×¤×™×•×ª: ${gameState.wisdomPoints} | ××•××¥: ${gameState.courageMeter} | ×”×©×¤×¢×”: ${gameState.influenceMeter}`;
            showScreen('gameOverScreen');
        }

        // Open Book of Wisdom
        function openBookOfWisdom() {
            const wisdomEntriesContainer = document.getElementById('wisdomEntriesContainer');
            wisdomEntriesContainer.innerHTML = ''; // Clear previous entries

            if (gameState.collectedWisdom.length === 0) {
                wisdomEntriesContainer.innerHTML = '<p>×”×¡×¤×¨ ×¢×“×™×™×Ÿ ×¨×™×§. ×‘×¦×¢ ×‘×—×™×¨×•×ª ×××•×–× ×•×ª ×›×“×™ ×œ×¦×‘×•×¨ ×—×•×›××”!</p>';
            } else {
                gameState.collectedWisdom.forEach((entry, index) => {
                    const div = document.createElement('div');
                    div.className = 'wisdom-entry';
                    div.innerHTML = `<strong>${index + 1}. ××”×¡×¦× ×”:</strong> ${entry.scene}<br>${entry.wisdom}`;
                    wisdomEntriesContainer.appendChild(div);
                });
            }
            showScreen('bookOfWisdomScreen');
        }

        // Close Book of Wisdom
        function closeBookOfWisdom() {
            showScreen('gameplayScreen'); // Go back to gameplay
            // Re-enable buttons if they were disabled before opening the book
            document.querySelectorAll('.choice-button').forEach(button => {
                button.disabled = false;
                button.style.opacity = 1;
                button.style.cursor = 'pointer';
            });
        }

        // Set initial screen on load (handled by body onload="initGame()")
    </script>
</body>
</html>
 